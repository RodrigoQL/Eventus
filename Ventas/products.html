<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Sistema</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>

<body>
    <form action="manager.html">
        <input type="submit" value="Inicio" />
    </form>
    <form action="manager_comissions.html">
        <input type="submit" value="Comisiones" />
    </form>
    <form action="manager_sales.html">
        <input type="submit" value="Ventas" />
    </form>
    <div id="section_1">
        <div class="container">
            <fieldset>
                <legend>Agregar linea de Producto</legend>
                <div>
                    <label for="product_name">Nombre:</label>
                    <input name="product_name" id="productname" type="text" placeholder="Linea de Producto" required autofocus>
                </div>
                <div>
                    <label for="comission">Comisión:</label>
                    <input name="comission" id="comission" type="number" placeholder="Comisión" required>
                </div>
                <div>
                    <input class="btn btn-default" name="submit" id="submitButton" type="submit" value ="Agregar Linea de Producto">
                </div>
            </fieldset>
        </div>
        <div id="productstable">

        </div>
    <script>
        window.onload = function () {
            checkSession();
            setUserValues();
            getProducts();
        };
        $('#submitButton').click(function () {
            var comission = $('#comission').val();
            var name = $('#productname').val();
            $.post("resources/Controllers.php",
                {
                    function: "CreateProductType",
                    name: name,
                    comission: comission
                },

                function (data) {
                    window.location.href = "products.html";
                });

        });

        function getProducts(){
        $.post("resources/Controllers.php", 
        {
            function: "ProductsTable",
        },
        
        function(data){
            $("#productstable").prepend(data);
        });
        }
        function setUserValues() {
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth()+1; 
            var yyyy = today.getFullYear();

            if(dd<10) {
                dd = '0'+dd;
            } 

            if(mm<10) {
                mm = '0'+mm;
            }
            
            today = mm + '/' + dd + '/' + yyyy;
            $.post("resources/Controllers.php",
                {
                    function: "GetUserCompleteName",
                },

                function (data) {
                    $('#user_name').attr('value', data);
                    $('#current_date').attr('value', today);
                });
        }

        function checkSession() {
            $.post("resources/Controllers.php",
                {
                    function: "CheckSession",
                },

                function (data) {
                    var typeId = parseInt(data);
                    if (typeId != 1) {
                        window.location.href = "index.html";
                    }
                });
        }
    </script>
</body>

</html>