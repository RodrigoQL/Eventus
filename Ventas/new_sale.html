<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Nueva Venta</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>

<body>
    <form action="index.html">
        <input type="submit" value="Inicio" />
    </form>
    <form action="sales.html">
        <input type="submit" value="Ventas" />
    </form>
    <form action="seller_comissions.html">
        <input type="submit" value="Comisiones" />
    </form>
    <h1>Nueva Venta</h1>
        <fieldset>
            <legend>Ingresar Datos</legend>
            <div>
                <label for="client-firstname">Nombre Cliente:</label>
                <input name="client-firstname" id="clientfirstname" type="text" placeholder="Nombre del cliente" required autofocus>
            </div>
            <div>
                <label for="client-lastname">Apellido Cliente:</label>
                <input name="client-lastname" id="clientlastname" type="text" placeholder="Apellido del cliente" required autofocus>
            </div>
            <div>
                <label for="company">Empresa:</label>
                <input name="company" id="company" type="text" placeholder="Nombre de la empresa" required autofocus>
            </div>
            <div>
                <label for="gross-amount">Monto Bruto:</label>
                <input name="gross-amount" id="amount" type="number" required autofocus>
            </div>
            <div>
                <label for="payment-date">Fecha de pago:</label>
                <input name="payment-date" id="payday" type="date" required autofocus>
            </div>
            <div id="productcontainer">
                <label for="product-line">Linea de producto:</label>

            </div>
            <div>
                <label for="invoice-number">Factura:</label>
                <input name="invoice-number" id="billnumber" type="text" required autofocus>
            </div>
            <div>
                <input class="btn btn-default" name="submit" id="submitButton" type="submit" value ="Ingresar venta">
            </div>
        </fieldset>
    <script>
        
        window.onload = function(){
            getProducts();
            checkSession();
        }

        function checkSession() {
            $.post("resources/Controllers.php",
                {
                    function: "CheckSession",
                },

                function (data) {
                    var typeId = parseInt(data);
                    if (typeId != 2) {
                        window.location.href = "index.html";
                    }
                });
        }

        $('#submitButton').click(function(){
            var clientfirstname = $('#clientfirstname').val();
            var clientlastname = $('#clientlastname').val();
            var company = $('#company').val();
            var amount = $('#amount').val();
            var payday = $('#payday').val();
            var product = $('#selectedProduct').val();
            var billnumber = $('#billnumber').val();

            $.post("resources/Controllers.php", 
            {
                function: "CreateSale",
                clientfirstname: clientfirstname,
                clientlastname: clientlastname,
                company: company,
                amount: amount,
                payday: payday,
                billnumber: billnumber,
                producttypeid: product
            },

            function(data){
                alert(data);
            });
        
        })

        function getProducts(){
        $.post("resources/Controllers.php", 
        {
            function: "ProductsDropdown",
        },
        
        function(data){
            $("#productcontainer").prepend(data);
        });
        }
    </script>
</body>

</html>